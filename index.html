<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BrightXStream Premium - Focus & Flow</title>
    <!-- Load Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@100..900&display=swap');
        
        /* Define Custom Blue Palette and Shadows */
        :root {
            --color-bg-primary: #0A101C;     /* Deep Night Blue */
            --color-bg-secondary: #121B2F;   /* Darker Navy/Slate for cards */
            --color-accent: #3B82F6;         /* Electric Blue */
            --color-text-light: #E0E7FF;     /* Pale Blue/White */
            --color-text-muted: #94A3B8;     /* Slate 400 */
        }

        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--color-bg-primary);
            min-height: 100vh;
            color: var(--color-text-light);
        }

        /* --- Premium Card Style with Depth and Hover Glow --- */
        .premium-card {
            background-color: var(--color-bg-secondary);
            transition: all 0.3s cubic-bezier(0.25, 0.46, 0.45, 0.94);
            border: 1px solid rgba(59, 130, 246, 0.1);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.4);
        }
        
        .premium-card:hover {
            transform: translateY(-5px) scale(1.01);
            /* Electric Blue Glow */
            box-shadow: 
                0 0 8px var(--color-accent), 
                0 18px 35px rgba(59, 130, 246, 0.2);
            border-color: var(--color-accent);
        }

        /* Play button glow pulse animation */
        .play-btn-pulse {
            transition: all 0.2s;
            box-shadow: 0 0 10px rgba(59, 130, 246, 0.6);
        }

        .play-btn-pulse:hover {
            animation: glow-pulse 1.8s infinite;
        }

        @keyframes glow-pulse {
            0% { box-shadow: 0 0 8px rgba(59, 130, 246, 0.6); }
            50% { box-shadow: 0 0 24px rgba(59, 130, 246, 0.9), 0 0 8px rgba(59, 130, 246, 0.8); }
            100% { box-shadow: 0 0 8px rgba(59, 130, 246, 0.6); }
        }

        /* --- Custom Scrollbar for dark themes --- */
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-thumb {
            background: var(--color-accent);
            border-radius: 10px;
        }
        .horizontal-scroll-container::-webkit-scrollbar { height: 6px; }
        .horizontal-scroll-container::-webkit-scrollbar-thumb {
            background: rgba(59, 130, 246, 0.4);
        }
        
        /* Custom progress bar thumb style */
        #progress-bar::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 14px;
            height: 14px;
            background: #ffffff; /* White center */
            border: 3px solid var(--color-accent);
            border-radius: 50%;
            cursor: pointer;
            box-shadow: 0 0 8px rgba(59, 130, 246, 0.8);
        }

        /* Custom progress bar track gradient */
        #progress-bar {
            background: linear-gradient(to right, var(--color-accent) 0%, var(--color-accent) 0%, #1E293B 0%, #1E293B 100%);
        }
    </style>
</head>
<body oncontextmenu="return false;">

    <!-- Hidden Audio Element -->
    <audio id="audio-player"></audio>

    <!-- Header / Navigation Bar -->
    <header class="bg-[#0A101C]/95 backdrop-blur-md sticky top-0 z-20 border-b border-blue-500/20 shadow-xl">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4 flex justify-between items-center">
            <h1 class="text-3xl font-extrabold text-white cursor-pointer hover:text-blue-400 transition-colors" onclick="app.navigate('home')">
                BrightX<span class="text-blue-500">Stream</span>
            </h1>
            <nav class="space-x-3 sm:space-x-5 flex items-center">
                <button class="text-sm font-medium text-slate-300 hover:text-blue-500 transition-colors" onclick="app.navigate('home')">Home</button>
                <!-- Simplified Category Navigation for space -->
                <button class="text-sm font-medium text-slate-300 hover:text-blue-500 transition-colors hidden sm:block" onclick="app.navigate('category', 'Focus')">Focus</button>
                <button class="text-sm font-medium text-slate-300 hover:text-blue-500 transition-colors hidden md:block" onclick="app.navigate('category', 'Relax')">Relax</button>
                <button class="text-sm font-medium text-slate-300 hover:text-blue-500 transition-colors hidden lg:block" onclick="app.navigate('category', 'Code')">Code</button>
                <button class="text-sm font-semibold bg-blue-600 text-white py-2 px-5 rounded-full shadow-lg shadow-blue-500/40 hover:bg-blue-500 transition-all duration-200 transform hover:scale-[1.03]">
                    Premium <span class="text-xs font-light ml-1">✨</span>
                </button>
            </nav>
        </div>
    </header>

    <!-- Main Content Area -->
    <main id="app-content" class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 pt-12 pb-40">
        <!-- Content will be injected here by JavaScript -->
    </main>

    <!-- Persistent Audio Player -->
    <footer id="persistent-player" class="fixed bottom-0 left-0 w-full bg-[#121B2F] border-t border-blue-500/40 text-white shadow-2xl shadow-black/80 z-30 transform translate-y-full transition-transform duration-300 ease-in-out">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-3 flex items-center justify-between">
            
            <!-- Track Info -->
            <div class="flex items-center space-x-3 w-1/4 min-w-0">
                <div class="w-12 h-12 bg-blue-700/60 rounded-lg flex items-center justify-center shadow-lg shadow-blue-500/20">
                    <!-- Icon: Speaker -->
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="w-6 h-6 text-white"><polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"/><path d="M15.54 8.46a5 5 0 0 1 0 7.07"/></svg>
                </div>
                <div class="truncate hidden sm:block">
                    <p id="player-title" class="font-semibold text-sm truncate">Not Playing</p>
                    <p id="player-artist" class="text-xs text-slate-400 truncate">BrightXStream</p>
                </div>
            </div>

            <!-- Controls and Progress -->
            <div class="flex flex-col items-center w-2/4 space-y-2">
                <div class="flex space-x-6 items-center">
                    <button id="player-prev" class="text-slate-500 hover:text-blue-400 transition-colors disabled:opacity-30">
                         <!-- Skip Back Icon -->
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="w-5 h-5"><polygon points="19 20 9 12 19 4 19 20"/><line x1="5" x2="5" y1="19" y2="5"/></svg>
                    </button>
                    <button id="player-play-pause" class="text-white bg-blue-600 p-3 rounded-full play-btn-pulse transition-all duration-200 transform hover:scale-105">
                        <!-- Play Icon -->
                        <svg id="play-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="w-6 h-6"><path fill-rule="evenodd" d="M4.5 5.653c0-1.426 1.529-2.33 2.779-1.643l11.54 6.348c1.295.712 1.295 2.573 0 3.285L7.28 20.991c-1.25.687-2.779-.217-2.779-1.643V5.653Z" clip-rule="evenodd" /></svg>
                        <!-- Pause Icon -->
                        <svg id="pause-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="w-6 h-6 hidden"><path fill-rule="evenodd" d="M6.75 5.25a.75.75 0 0 1 .75-.75H9a.75.75 0 0 1 .75.75v13.5a.75.75 0 0 1-.75.75H7.5a.75.75 0 0 1-.75-.75V5.25Zm7.5 0A.75.75 0 0 1 15 4.5h1.5a.75.75 0 0 1 .75.75v13.5a.75.75 0 0 1-.75.75H15a.75.75 0 0 1-.75-.75V5.25Z" clip-rule="evenodd" /></svg>
                    </button>
                    <button id="player-next" class="text-slate-500 hover:text-blue-400 transition-colors disabled:opacity-30">
                        <!-- Skip Forward Icon -->
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="w-5 h-5"><polygon points="5 4 15 12 5 20 5 4"/><line x1="19" x2="19" y1="5" y2="19"/></svg>
                    </button>
                </div>
                <!-- Progress Bar -->
                <div class="flex items-center w-full max-w-lg space-x-3">
                    <span id="player-time-current" class="text-xs text-slate-400 w-8 text-right">0:00</span>
                    <input type="range" id="progress-bar" value="0" max="100" class="w-full h-1.5 bg-slate-700 rounded-full appearance-none cursor-pointer">
                    <span id="player-time-duration" class="text-xs text-slate-400 w-8 text-left">0:00</span>
                </div>
            </div>

            <!-- Volume Control -->
            <div class="flex items-center space-x-3 w-1/4 justify-end">
                 <!-- Volume Icon -->
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="w-5 h-5 text-slate-400 hidden lg:block"><polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"/><path d="M15.54 8.46a5 5 0 0 1 0 7.07"/></svg>
                <input type="range" id="volume-bar" value="100" max="100" class="w-24 h-1.5 bg-slate-700 rounded-full appearance-none cursor-pointer hidden lg:block" style="accent-color: var(--color-accent);">
            </div>
        </div>
    </footer>


    <script>
        // --- MOCK DATA (Updated with 6 categories: Focus, Relax, Learn, Meditate, Amplify, Code) ---
        const audioData = [
            // Focus
            { id: 1, 
                title: "Zen Garden Lofi", 
                artist: "BrightXStream Collective", 
                category: "Focus", 
                duration: "4:30", 
                durationSeconds: 270, 
                url: "https://raw.githubusercontent.com/SurajitCoder/Computer-Audio/c342c6cad8eec38dffe224d05bdc48fa56085c95/Word_Processor_and_MS_Word.mp3", 
                description: "The perfect low-key soundtrack to kickstart deep work sessions.", 
                blogContent: "This track combines traditional Japanese instrumentation with modern lofi drums to create an optimal flow state. Featured in our Staff Picks.", 
                accompanyingPDF: "https://raw.githubusercontent.com/LofiStreamer/BrightXStream-Content/main/documents/focus_guide.pdf" 
            },
            // Meditate
            { id: 2, 
                title: "Coastal Waves Meditation", 
                artist: "Dr. Serenity", 
                category: "Meditate", 
                duration: "8:00", durationSeconds: 480, 
                url: "https://raw.githubusercontent.com/LofiStreamer/BrightXStream-Content/main/nature/coastal_waves.mp3", 
                description: "Eight minutes of natural white noise mixed with subtle binaural tones for deep meditation.", 
                blogContent: "Dr. Serenity has blended delta waves into this natural soundscape to aid in stress reduction and pre-sleep preparation. Listen at a low volume for best results.", 
                accompanyingPDF: "" },
            // Learn
            { id: 3, 
                title: "History in 5: The Roman Republic", 
                artist: "Micro-Lessons", 
                category: "Learn", 
                duration: "5:15", 
                durationSeconds: 315, 
                url: "https://raw.githubusercontent.com/LofiStreamer/BrightXStreamer-Content/main/learning/roman_republic.mp3", 
                description: "A concise summary of the key figures and events that shaped the early Roman Republic.", 
                blogContent: "Part of our new 'History in 5' series, designed for quick learning during your commute or workout. New episodes every Tuesday.", 
                accompanyingPDF: "" },
            // Relax
            { id: 4, 
                title: "City Rain Chill", 
                artist: "BrightXStream Collective", 
                category: "Relax", 
                duration: "3:45", 
                durationSeconds: 225, 
                url: "https://raw.githubusercontent.com/LofiStreamer/BrightXStream-Content/main/lofi_beats/city_rain.mp3", 
                description: "A gentle blend of rain sounds and soft jazz keys for winding down.", 
                blogContent: "The ambient sound of a distant thunderstorm mixed with soft piano loops. Ideal for study sessions or reading.", 
                accompanyingPDF: "" },
            // Code
            { id: 5, 
                title: "Cyber-Synthesizer Code Flow", 
                artist: "Zenith Beats", 
                category: "Code2", 
                duration: "12:00", 
                durationSeconds: 720, 
                url: "https://raw.githubusercontent.com/LofiStreamer/BrightXStream-Content/main/lofi_beats/zen_garden.mp3", 
                description: "Minimalist ambient soundscape with retro computer sounds for ultra-deep concentration while coding.", 
                blogContent: "Utilizing low frequency oscillations to block external noise. Great for complex coding tasks.", 
                accompanyingPDF: "" },
            // Relax
            { id: 6, 
                title: "Tropical Waterfall", 
                artist: "Dr. Serenity", 
                category: "Relax", 
                duration: "6:20", 
                durationSeconds: 380, 
                url: "https://raw.githubusercontent.com/LofiStreamer/BrightXStream-Content/main/nature/coastal_waves.mp3", 
                description: "The powerful yet soothing sound of a distant waterfall.", 
                blogContent: "Natural white noise that masks disruptive sounds. Excellent for mindfulness.", 
                accompanyingPDF: "" },
            // Amplify
            { id: 7, 
                title: "High-Energy Neuro Bass", 
                artist: "Surajit Halder", 
                category: "Amplify", 
                duration: "7:20", 
                durationSeconds: 440, 
                url: "https://raw.githubusercontent.com/LofiStreamer/BrightXStreamer-Content/main/learning/roman_republic.mp3", 
                description: "Fast-paced electronic music to boost energy and motivation.", 
                blogContent: "Designed to elevate heart rate and focus attention on dynamic tasks. Use for workouts or high-intensity work.", 
                accompanyingPDF: "" },
            // Meditate
            { id: 8, 
                title: "Forest Bathing Sounds", 
                artist: "Dr. Serenity", 
                category: "Meditate", 
                duration: "10:00", 
                durationSeconds: 600, 
                url: "https://raw.githubusercontent.com/LofiStreamer/BrightXStream-Content/main/nature/coastal_waves.mp3", 
                description: "Ten minutes of tranquil forest sounds for restorative meditation.", 
                blogContent: "A powerful natural soundscape.", 
                accompanyingPDF: "" },
            // Code
            { id: 9, 
                title: "Functional Programming Beats", 
                artist: "Code Flow", 
                category: "Code", 
                duration: "5:50", 
                durationSeconds: 350, 
                url: "https://raw.githubusercontent.com/LofiStreamer/BrightXStream-Content/main/lofi_beats/city_rain.mp3", 
                description: "Steady rhythm, minimal vocals. Perfect for debugging.", 
                blogContent: "Lofi with a steady beat for deep work.", 
                accompanyingPDF: "" },
            // Amplify
            { id: 10, 
                title: "The Startup Grind", 
                artist: "The Hustle", 
                category: "Amplify", 
                duration: "3:10", 
                durationSeconds: 190, 
                url: "https://raw.githubusercontent.com/LofiStreamer/BrightXStream-Content/main/lofi_beats/zen_garden.mp3", 
                description: "A motivational track built on synthwave loops.", 
                blogContent: "Get that boost you need.", 
                accompanyingPDF: "" },
        ];

        // Global State and Elements
        const app = {
            content: document.getElementById('app-content'),
            playerBar: document.getElementById('persistent-player'),
            audioElement: document.getElementById('audio-player'),
            currentTrack: null,
            isPlaying: false,
            // State for filtering and sorting
            searchQuery: '',
            sortKey: 'title_asc', // Default sort: title A-Z
            
            // In-memory array for recent plays (stores track IDs, most recent first)
            recentPlays: [], 

            // Navigation function
            navigate(view, param = null) {
                app.content.scrollTop = 0; // Scroll to top on navigation
                // Push or replace history state (simplified for a single file app)
                const url = `#${view}${param ? '-' + param : ''}`;
                window.history.pushState({ view, param }, '', url);

                if (view === 'home') {
                    app.renderHome();
                } else if (view === 'category') {
                    app.renderCategory(param);
                } else if (view === 'detail') {
                    app.renderDetail(param);
                }
            },

            // --- FILTERING AND SORTING UTILITY ---
            getFilteredAndSortedTracks(tracks) {
                let filteredTracks = [...tracks];
                const query = app.searchQuery.toLowerCase();

                // 1. Filtering (Search)
                if (query) {
                    filteredTracks = filteredTracks.filter(track =>
                        track.title.toLowerCase().includes(query) ||
                        track.artist.toLowerCase().includes(query) ||
                        track.category.toLowerCase().includes(query)
                    );
                }

                // 2. Sorting
                filteredTracks.sort((a, b) => {
                    switch (app.sortKey) {
                        case 'title_asc':
                            return a.title.localeCompare(b.title);
                        case 'duration_asc':
                            // Sort by duration in seconds (shortest first)
                            return a.durationSeconds - b.durationSeconds;
                        case 'artist_asc':
                            return a.artist.localeCompare(b.artist);
                        default:
                            return 0;
                    }
                });

                return filteredTracks;
            }
        };

        // --- Utility Functions ---

        // Helper to format seconds into M:SS
        const formatTime = (seconds) => {
            const min = Math.floor(seconds / 60);
            const sec = Math.floor(seconds % 60);
            return `${min}:${sec < 10 ? '0' : ''}${sec}`;
        };

        // Function to update the progress bar background gradient
        const updateProgressBarGradient = (progress) => {
            player.progressBar.style.background = `linear-gradient(to right, var(--color-accent) ${progress}%, #1E293B ${progress}%, #1E293B 100%)`;
        };

        // --- AUDIO PLAYER LOGIC ---

        const player = {
            title: document.getElementById('player-title'),
            artist: document.getElementById('player-artist'),
            playPauseButton: document.getElementById('player-play-pause'),
            playIcon: document.getElementById('play-icon'),
            pauseIcon: document.getElementById('pause-icon'),
            progressBar: document.getElementById('progress-bar'),
            currentTime: document.getElementById('player-time-current'),
            durationTime: document.getElementById('player-time-duration'),
            volumeBar: document.getElementById('volume-bar'),
            prevButton: document.getElementById('player-prev'),
            nextButton: document.getElementById('player-next'),
            
            // Loads and starts playing a track
            loadAndPlay(trackId) {
                const track = audioData.find(t => t.id === trackId);
                if (!track) return;

                // 1. Update Recent Plays History (most recent first)
                app.recentPlays = app.recentPlays.filter(id => id !== trackId);
                app.recentPlays.unshift(trackId);
                app.recentPlays = app.recentPlays.slice(0, 6);
                
                app.currentTrack = track;
                app.audioElement.src = track.url;
                app.audioElement.load();
                app.audioElement.play();
                
                // Update player UI
                player.title.textContent = track.title;
                player.artist.textContent = track.artist;
                app.playerBar.classList.remove('translate-y-full'); // Show player
                player.updateControls(true);
                player.updateNavControls();
            },
            
            // Toggles play/pause state
            togglePlayPause() {
                if (!app.currentTrack) return;
                
                if (app.isPlaying) {
                    app.audioElement.pause();
                    player.updateControls(false);
                } else {
                    app.audioElement.play();
                    player.updateControls(true);
                }
            },

            // Updates the play/pause icon appearance
            updateControls(playing) {
                app.isPlaying = playing;
                if (playing) {
                    player.playIcon.classList.add('hidden');
                    player.pauseIcon.classList.remove('hidden');
                } else {
                    player.playIcon.classList.remove('hidden');
                    player.pauseIcon.classList.add('hidden');
                }
            },

            // Logic to enable/disable Prev/Next buttons based on recentPlays history
            updateNavControls() {
                if (!app.currentTrack || app.recentPlays.length === 0) {
                    player.prevButton.disabled = true;
                    player.nextButton.disabled = true;
                    return;
                }
                
                const currentIndex = app.recentPlays.indexOf(app.currentTrack.id);
                
                // Next track is chronologically newer (index < currentIndex)
                player.nextButton.disabled = currentIndex === 0;

                // Previous track is chronologically older (index > currentIndex)
                player.prevButton.disabled = currentIndex === app.recentPlays.length - 1;
            },

            // Plays the chronologically newer track (lower index in recentPlays)
            playNext() {
                if (!app.currentTrack) return;
                const currentIndex = app.recentPlays.indexOf(app.currentTrack.id);
                const nextIndex = currentIndex - 1; // Newer track
                
                if (nextIndex >= 0) {
                    player.loadAndPlay(app.recentPlays[nextIndex]);
                }
            },

            // Plays the chronologically older track (higher index in recentPlays)
            playPrev() {
                if (!app.currentTrack) return;
                const currentIndex = app.recentPlays.indexOf(app.currentTrack.id);
                const prevIndex = currentIndex + 1; // Older track
                
                if (prevIndex < app.recentPlays.length) {
                    player.loadAndPlay(app.recentPlays[prevIndex]);
                }
            },

            // Event handler for time updates
            handleTimeUpdate() {
                if (!isNaN(app.audioElement.duration) && app.audioElement.duration > 0) {
                    const progress = (app.audioElement.currentTime / app.audioElement.duration) * 100;
                    player.progressBar.value = progress;
                    player.currentTime.textContent = formatTime(app.audioElement.currentTime);
                    updateProgressBarGradient(progress);
                }
            },
            
            // Event handler for metadata loaded (duration available)
            handleLoadedMetadata() {
                player.durationTime.textContent = formatTime(app.audioElement.duration);
            },

            // Event handler for seeking
            handleSeeking(e) {
                const seekTime = (e.target.value / 100) * app.audioElement.duration;
                app.audioElement.currentTime = seekTime;
            },

            // Event handler for volume change
            handleVolumeChange(e) {
                app.audioElement.volume = e.target.value / 100;
            }
        };

        // Attach Player Events
        player.playPauseButton.addEventListener('click', player.togglePlayPause);
        player.progressBar.addEventListener('input', player.handleSeeking);
        player.volumeBar.addEventListener('input', player.handleVolumeChange);
        app.audioElement.addEventListener('timeupdate', player.handleTimeUpdate);
        app.audioElement.addEventListener('loadedmetadata', player.handleLoadedMetadata);
        app.audioElement.addEventListener('ended', () => player.updateControls(false));
        player.nextButton.addEventListener('click', player.playNext);
        player.prevButton.addEventListener('click', player.playPrev);

        // Initialize volume and Nav controls
        app.audioElement.volume = player.volumeBar.value / 100;
        player.updateNavControls();

        // --- VIEW RENDERERS ---

        // Helper function for rendering a smaller, horizontal track card
        app.renderSmallTrackCard = (track) => `
            <div class="w-48 flex-shrink-0 premium-card p-4 rounded-xl cursor-pointer shadow-lg hover:shadow-blue-500/30">
                <div class="relative group" onclick="player.loadAndPlay(${track.id})">
                    <!-- Placeholder Album Art/Icon -->
                    <div class="w-full h-32 bg-blue-900/40 rounded-lg mb-3 flex items-center justify-center text-blue-400 border border-blue-500/20">
                        <!-- Headphone Icon -->
                        <svg xmlns="http://www.w3.org/2000/svg" width="40" height="40" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><path d="M12 2a10 10 0 0 0-10 10v2a8 8 0 0 0 16 0v-2a10 10 0 0 0-10-10z"/><path d="M12 2v10"/></svg>
                    </div>
                    <!-- Play Overlay Button -->
                    <button class="absolute inset-0 w-full h-full flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity bg-black/50 rounded-lg">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="w-10 h-10 text-white play-btn-pulse"><path fill-rule="evenodd" d="M4.5 5.653c0-1.426 1.529-2.33 2.779-1.643l11.54 6.348c1.295.712 1.295 2.573 0 3.285L7.28 20.991c-1.25.687-2.779-.217-2.779-1.643V5.653Z" clip-rule="evenodd" /></svg>
                    </button>
                </div>
                <p class="font-bold text-sm text-white truncate">${track.title}</p>
                <p class="text-xs text-slate-400">${track.artist}</p>
            </div>
        `;

        // Function to return an SVG icon based on category name
        const getCategoryIcon = (category) => {
            switch (category) {
                case 'Focus':
                    return '<svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 2v20M17 5H7M17 19H7"/></svg>'; 
                case 'Relax':
                    return '<svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><path d="M8 12h8"/></svg>';
                case 'Meditate':
                    return '<svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 17c-2.4 0-4-2-4-4s1.6-4 4-4 4 2 4 4-1.6 4-4 4z"/><path d="M12 17v4M8.5 17.5l-1.5 1.5M15.5 17.5l1.5 1.5M4 12h2M18 12h2M12 4v2M7 7l1 1M16 7l-1 1"/></svg>';
                case 'Amplify':
                    return '<svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M13 2H8L2 12h7l-1 9 10-10H13z"/></svg>';
                case 'Code':
                    return '<svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="16 18 22 12 16 6"/><polyline points="8 6 2 12 8 18"/></svg>';
                case 'Learn':
                    return '<svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M4 19.5v-15A2.5 2.5 0 0 1 6.5 2H20v20H6.5a2.5 2.5 0 0 1 0-5H20"/></svg>';
                case 'Code2':
                    return '<svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="16 18 22 12 16 6"/><polyline points="8 6 2 12 8 18"/></svg>';
                default:
                    return '<svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/></svg>';
            }
        };

        // 1. Home Page Renderer
        app.renderHome = () => {
            const categories = [...new Set(audioData.map(t => t.category))].sort();
            const allSortedTracks = app.getFilteredAndSortedTracks(audioData);
            const featuredTracks = allSortedTracks.slice(0, 4);

            const recentTracks = app.recentPlays
                .map(id => audioData.find(t => t.id === id))
                .filter(track => track);

            app.content.innerHTML = `
                <section id="hero" class="text-center py-20 px-6 bg-[#121B2F]/70 rounded-3xl shadow-2xl shadow-blue-900/40 mb-16 border border-blue-500/30 backdrop-blur-sm">
                    <h2 class="text-5xl sm:text-6xl lg:text-7xl font-extrabold mb-4 leading-tight tracking-tight">
                        Enter the 
                        <span class="bg-clip-text text-transparent bg-gradient-to-r from-blue-400 to-blue-600">
                            BrightX Flow
                        </span> State
                    </h2>
                    <p class="text-xl text-slate-300 mb-10 max-w-2xl mx-auto">
                        Curated audio streams for ultimate focus, relaxation, and cognitive boost.
                    </p>
                    <button onclick="app.navigate('category', 'Focus')" class="bg-blue-600 text-white text-xl font-bold py-3.5 px-10 rounded-full play-btn-pulse hover:bg-blue-500 transition transform hover:scale-[1.03] duration-300">
                        Start Deep Work <span class="ml-2">→</span>
                    </button>
                </section>
                
                ${recentTracks.length > 0 ? `
                    <!-- Recent Plays Section -->
                    <section class="mb-16">
                        <h3 class="text-3xl sm:text-4xl font-bold mb-6 border-l-4 border-blue-500 pl-4 text-white">Recently Streamed</h3>
                        <!-- Horizontal Scroll Container -->
                        <div class="flex overflow-x-auto space-x-6 pb-4 horizontal-scroll-container">
                            ${recentTracks.map(track => app.renderSmallTrackCard(track)).join('')}
                        </div>
                    </section>
                ` : ''}

                <!-- Featured Categories (Updated Grid Layout for 6 cards) -->
                <section class="mb-16">
                    <h3 class="text-3xl sm:text-4xl font-bold mb-8 border-l-4 border-blue-500 pl-4 text-white">Explore All (${categories.length} Categories)</h3>
                    <!-- Responsive Grid: 1 column on tiny screens, up to 6 on largest -->
                    <div class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-6 gap-4 sm:gap-6">
                        ${categories.map(cat => `
                            <div onclick="app.navigate('category', '${cat}')" class="premium-card p-4 sm:p-6 rounded-xl cursor-pointer flex flex-col items-center text-center">
                                <div class="w-12 h-12 bg-blue-600 rounded-full flex items-center justify-center mb-3 text-white shadow-lg shadow-blue-500/40">
                                     <!-- Icon based on category -->
                                    ${getCategoryIcon(cat)}
                                </div>
                                <p class="text-base sm:text-lg font-semibold mb-0.5 text-white">${cat}</p>
                                <p class="text-slate-400 text-xs">${audioData.filter(t => t.category === cat).length} Tracks</p>
                            </div>
                        `).join('')}
                    </div>
                </section>

                <!-- Top Picks (Filtered and Sorted) -->
                <section>
                    <h3 class="text-3xl sm:text-4xl font-bold mb-8 border-l-4 border-blue-500 pl-4 text-white">Staff Top Picks</h3>
                    <div class="space-y-4">
                        ${featuredTracks.length > 0 ? featuredTracks.map(track => app.renderAudioCard(track)).join('') : '<p class="text-slate-400 p-4 text-center">No featured tracks available.</p>'}
                    </div>
                </section>
            `;
        };

        // 2. Category Page Renderer
        app.renderCategory = (category) => {
            const rawTracks = audioData.filter(t => t.category === category);
            const tracks = app.getFilteredAndSortedTracks(rawTracks);
            
            app.content.innerHTML = `
                <h2 class="text-4xl sm:text-5xl font-extrabold mb-10 text-white border-l-4 border-blue-500 pl-4">${category} Sound Library</h2>
                
                <!-- Search and Sort Controls -->
                <div class="flex flex-col sm:flex-row gap-4 mb-8">
                    <!-- Search Input -->
                    <div class="relative flex-grow">
                        <input type="text" id="search-input" placeholder="Search tracks or artists..." value="${app.searchQuery}"
                               class="w-full bg-[#1A253A] border border-slate-600 rounded-xl py-3 pl-12 pr-4 text-white placeholder-slate-400 focus:outline-none focus:ring-2 focus:ring-blue-500 transition duration-150 shadow-md">
                        <!-- Search Icon -->
                        <svg class="absolute left-4 top-1/2 transform -translate-y-1/2 w-5 h-5 text-slate-400" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="11" cy="11" r="8"/><path d="m21 21-4.3-4.3"/></svg>
                    </div>

                    <!-- Sort Dropdown -->
                    <div class="relative">
                        <select id="sort-select" class="appearance-none bg-[#1A253A] border border-slate-600 rounded-xl py-3 pl-4 pr-10 text-white focus:outline-none focus:ring-2 focus:ring-blue-500 transition duration-150 shadow-md" onchange="handleSortChange(this.value)">
                            <option value="title_asc">Sort By: A-Z Title</option>
                            <option value="duration_asc">Sort By: Shortest Duration</option>
                            <option value="artist_asc">Sort By: Artist A-Z</option>
                        </select>
                        <!-- Dropdown Arrow Icon -->
                        <svg class="absolute right-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-slate-400 pointer-events-none" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m6 9 6 6 6-6"/></svg>
                    </div>
                </div>

                <div class="space-y-4">
                    ${tracks.length > 0 ? tracks.map(track => app.renderAudioCard(track)).join('') : '<p class="text-slate-400 p-8 text-center bg-[#1A253A] rounded-xl shadow-lg">No tracks found in this category matching your search criteria.</p>'}
                </div>
            `;
            
            // Set the current sort value
            document.getElementById('sort-select').value = app.sortKey;

            // Attach event listener for search input AFTER rendering
            const searchInput = document.getElementById('search-input');
            searchInput.addEventListener('input', (e) => {
                app.searchQuery = e.target.value;
                app.navigate('category', category); 
            });
        };

        // Global functions for handling user input
        const handleSortChange = (value) => {
            app.sortKey = value;
            // Get current view details from history/URL hash
            const state = window.history.state;
            if (state && state.view === 'category' && state.param) {
                app.navigate('category', state.param); // Re-render the current category
            } else {
                app.navigate('home'); // Fallback to re-render home if needed
            }
        };

        // Audio Card HTML Generator
        app.renderAudioCard = (track) => `
            <div class="premium-card p-4 rounded-xl flex items-center justify-between transition duration-300 cursor-pointer border-l-4 border-blue-600 hover:border-blue-400">
                
                <!-- Left Section: Icon and Track Details -->
                <div class="flex items-center space-x-4 min-w-0 flex-grow" onclick="app.navigate('detail', ${track.id})">
                    <!-- Album Art/Icon -->
                    <div class="flex-shrink-0 w-12 h-12 rounded-md bg-blue-700/60 flex items-center justify-center text-white shadow-md shadow-blue-500/30">
                        <!-- Headphone Icon -->
                        <svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><path d="M12 2a10 10 0 0 0-10 10v2a8 8 0 0 0 16 0v-2a10 10 0 0 0-10-10z"/><path d="M12 2v10"/></svg>
                    </div>
                    
                    <div class="min-w-0 flex-grow">
                        <p class="font-bold text-lg text-white truncate">${track.title}</p>
                        <p class="text-sm text-slate-400 mt-0.5 truncate">
                            ${track.artist} • <span class="text-blue-400">${track.category}</span>
                        </p>
                    </div>
                </div>
                
                <!-- Right Section: Duration and Controls -->
                <div class="flex items-center space-x-4 flex-shrink-0 ml-4">
                    <span class="text-sm font-mono text-blue-400 hidden sm:block">${track.duration}</span>
                    
                    <button onclick="player.loadAndPlay(${track.id})" class="play-btn-pulse text-white bg-blue-600 p-2.5 rounded-full hover:bg-blue-500 transition-all duration-200 transform hover:scale-105">
                         <!-- Play Icon -->
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="w-5 h-5"><path fill-rule="evenodd" d="M4.5 5.653c0-1.426 1.529-2.33 2.779-1.643l11.54 6.348c1.295.712 1.295 2.573 0 3.285L7.28 20.991c-1.25.687-2.779-.217-2.779-1.643V5.653Z" clip-rule="evenodd" /></svg>
                    </button>
                    
                    <button onclick="app.navigate('detail', ${track.id})" class="text-slate-400 bg-slate-700/50 p-2 rounded-full hover:bg-slate-600/50 transition-colors transform hover:rotate-2">
                         <!-- Info Icon -->
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><path d="M12 16v-4"/><path d="M12 8h.01"/></svg>
                    </button>
                </div>
            </div>
        `;

        // 3. Detail/Blog Page Renderer (Redesigned for better visual hierarchy)
        app.renderDetail = (trackId) => {
            const track = audioData.find(t => t.id === trackId);
            if (!track) return app.navigate('home');

            app.content.innerHTML = `
                <div class="bg-[#121B2F]/90 backdrop-blur-sm p-6 sm:p-10 lg:p-12 rounded-2xl shadow-2xl shadow-blue-900/40 border border-blue-500/20">
                    
                    <!-- Header and Back Button -->
                    <div class="flex flex-col sm:flex-row items-start sm:items-center space-y-4 sm:space-y-0 sm:space-x-4 mb-8 border-b border-slate-700 pb-4">
                        <button onclick="window.history.back()" class="text-blue-500 hover:text-blue-400 transition transform hover:-translate-x-1 p-2 rounded-full bg-slate-700/50">
                            <!-- Back Arrow Icon -->
                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="w-7 h-7"><path fill-rule="evenodd" d="M11.03 3.48a.75.75 0 0 1 0 1.06L5.81 10.5h14.44a.75.75 0 0 1 0 1.5H5.81l5.22 5.96a.75.75 0 1 1-1.06 1.06l-6.5-7.425a.75.75 0 0 1 0-1.06l6.5-7.425a.75.75 0 0 1 1.06 0Z" clip-rule="evenodd" /></svg>
                        </button>
                        <h2 class="text-4xl sm:text-5xl font-extrabold text-white leading-tight">${track.title}</h2>
                    </div>

                    <div class="grid grid-cols-1 lg:grid-cols-3 gap-8 mb-10">
                        
                        <!-- Metadata Card -->
                        <div class="bg-slate-800 p-6 rounded-xl shadow-inner border border-blue-500/30">
                            <p class="text-xl font-semibold text-blue-400 mb-4 flex items-center">
                                ${getCategoryIcon(track.category)} <span class="ml-3">Track Details</span>
                            </p>
                            <div class="space-y-3">
                                <p class="text-base text-slate-300"><span class="font-bold text-blue-300">Artist:</span> ${track.artist}</p>
                                <p class="text-base text-slate-300"><span class="font-bold text-blue-300">Category:</span> ${track.category}</p>
                                <p class="text-base text-slate-300"><span class="font-bold text-blue-300">Duration:</span> ${track.duration}</p>
                            </div>
                        </div>
                        
                        <!-- Description and CTA -->
                        <div class="lg:col-span-2 flex flex-col justify-between space-y-6">
                            
                            <!-- Description -->
                            <div class="prose max-w-none text-slate-200">
                                <h3 class="text-3xl font-bold text-white mb-3">Track Summary</h3>
                                <p class="text-lg text-slate-300">${track.description}</p>
                            </div>

                            <!-- CTA Buttons -->
                            <div class="flex flex-col sm:flex-row space-y-3 sm:space-y-0 sm:space-x-4 mt-6 pt-6 border-t border-slate-700">
                                <button onclick="player.loadAndPlay(${track.id})" class="bg-blue-600 text-white font-bold text-lg py-3 px-8 rounded-full play-btn-pulse hover:bg-blue-500 transition transform hover:scale-105 shadow-xl shadow-blue-500/40">
                                    <span class="mr-2">▶</span> Stream Now
                                </button>
                                ${track.accompanyingPDF ? 
                                    `<a href="${track.accompanyingPDF}" target="_blank" class="text-blue-500 border border-blue-500 bg-slate-800 font-semibold py-3 px-8 rounded-full hover:bg-blue-500 hover:text-white transition-colors text-center shadow-md">
                                        View Companion PDF
                                    </a>` : 
                                    `<span class="text-slate-500 italic self-center">No companion material available.</span>`
                                }
                            </div>
                        </div>
                    </div>

                    <!-- Blog Content -->
                    <div class="prose max-w-none text-slate-300 mt-10 p-6 rounded-xl border border-blue-500/30 bg-slate-800/70">
                        <h3 class="text-3xl font-bold text-white border-b border-blue-500/50 pb-2 mb-4">The Story Behind the Sound</h3>
                        <p>${track.blogContent}</p>
                        <p>This track is analyzed for optimal neural engagement, ensuring maximum focus or relaxation depending on the category. Enjoy the premium experience with no interruptions.</p>
                    </div>
                </div>
            `;
        };
        
        // --- INITIALIZATION ---

        // Simple router: Listen for back/forward events
        window.onpopstate = () => {
            const hash = window.location.hash.substring(1);
            let view = 'home';
            let param = null;
            
            if (hash) {
                const parts = hash.split('-');
                view = parts[0];
                param = parts.slice(1).join('-') || null;
            }
            
            app.content.scrollTop = 0;
            if (view === 'home') {
                app.renderHome();
            } else if (view === 'category') {
                app.renderCategory(param);
            } else if (view === 'detail') {
                app.renderDetail(param);
            }
        };


        // Initial render based on URL or default to home
        const initialLoad = () => {
            const hash = window.location.hash.substring(1);
            let view = 'home';
            let param = null;
            
            if (hash) {
                const parts = hash.split('-');
                view = parts[0];
                param = parts.slice(1).join('-') || null;
            }
            
            // Set initial state without pushing a new history entry
            window.history.replaceState({ view, param }, '', window.location.hash);
            // Manually call the initial render function
            if (view === 'home') {
                app.renderHome();
            } else if (view === 'category') {
                app.renderCategory(param);
            } else if (view === 'detail') {
                app.renderDetail(param);
            }
        };
        
        window.onload = initialLoad;

        // Disable right-click context menu
        document.body.addEventListener('contextmenu', (e) => {
            e.preventDefault();
        });

    </script>
</body>
</html>



